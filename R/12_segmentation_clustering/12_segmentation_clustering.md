## Loading data

start with loading data

      data <- read.csv("../../data/processed/data_after_ACP.csv")
    head(data)

    ##         Dim.1     Dim.2
    ## 1  0.04166444 -2.884879
    ## 2 -0.71457840 -1.526207
    ## 3  2.45432650  1.038869
    ## 4  1.64647430  1.135281
    ## 5 -2.40885914  1.058930
    ## 6  3.02272301 -0.717887

## choosing the number of Clusters

    # Utilisation des scores de l'ACP (data_segmentation créée précédemment)
    library(factoextra)

    fviz_nbclust(data, kmeans, method = "wss") +
      geom_vline(xintercept = 3, linetype = 2) + # Exemple si le coude est à 3
      labs(title = "Méthode du Coude pour choisir le nombre de clusters")

![](12_segmentation_clustering_files/figure-markdown_strict/unnamed-chunk-2-1.png)

## applying clutering

    # On lance le K-means
    set.seed(123) # Pour avoir des résultats reproductibles
    km_res <- kmeans(data, centers = 3, nstart = 25)

    # On ajoute le numéro du cluster à nos données
    data$cluster <- as.factor(km_res$cluster)
    head(data)

    ##         Dim.1     Dim.2 cluster
    ## 1  0.04166444 -2.884879       1
    ## 2 -0.71457840 -1.526207       1
    ## 3  2.45432650  1.038869       2
    ## 4  1.64647430  1.135281       2
    ## 5 -2.40885914  1.058930       3
    ## 6  3.02272301 -0.717887       2

## displying Clusters

    fviz_cluster(km_res, data = data[, 1:2],
                 ellipse.type = "convex", 
                 palette = "jco",
                 ggtheme = theme_minimal())

![](12_segmentation_clustering_files/figure-markdown_strict/unnamed-chunk-4-1.png)

## combining the original data and clusters data

    raw_data <- read.csv("../../data/processed/credit_card_clean.csv")
    head(data)

    ##         Dim.1     Dim.2 cluster
    ## 1  0.04166444 -2.884879       1
    ## 2 -0.71457840 -1.526207       1
    ## 3  2.45432650  1.038869       2
    ## 4  1.64647430  1.135281       2
    ## 5 -2.40885914  1.058930       3
    ## 6  3.02272301 -0.717887       2

## data for the interpretation

    # 1. On ajoute les résultats du clustering au dataset d'origine (celui avec les 15 variables)
    donnees_finales <- cbind(raw_data, Cluster = km_res$cluster)

    # 2. On calcule la moyenne de chaque variable par cluster
    profil_clusters <- aggregate(. ~ Cluster, data = donnees_finales, FUN = mean)

    # 3. On affiche le résultat (transposé pour mieux lire)# 3. On affiche lmedian()e résultat (transposé pour mieux lire)
    print(t(profil_clusters))

    ##                                          [,1]         [,2]         [,3]
    ## Cluster                          1.000000e+00 2.000000e+00 3.000000e+00
    ## BALANCE                          6.913011e+02 7.515273e+02 1.789253e+03
    ## BALANCE_FREQUENCY                9.503914e-01 9.696104e-01 9.942006e-01
    ## PURCHASES                        1.141340e+02 5.677699e+02 8.377584e+01
    ## ONEOFF_PURCHASES                 6.991208e+01 2.147707e+02 6.220350e+01
    ## INSTALLMENTS_PURCHASES           4.424840e+01 3.530786e+02 2.208750e+01
    ## CASH_ADVANCE                     1.569858e+02 1.130327e+02 8.323818e+02
    ## PURCHASES_FREQUENCY              1.652317e-01 7.538095e-01 8.376434e-02
    ## ONEOFF_PURCHASES_FREQUENCY       5.761583e-02 1.128571e-01 4.209767e-02
    ## PURCHASES_INSTALLMENTS_FREQUENCY 1.025386e-01 6.644048e-01 3.994253e-02
    ## CASH_ADVANCE_FREQUENCY           5.518757e-02 3.071427e-02 2.104885e-01
    ## CASH_ADVANCE_TRX                 8.198675e-01 5.457143e-01 3.508621e+00
    ## PURCHASES_TRX                    2.336424e+00 1.317000e+01 1.451724e+00
    ## CREDIT_LIMIT                     2.231192e+03 2.719500e+03 2.862500e+03
    ## PAYMENTS                         4.429796e+02 6.280590e+02 7.138512e+02
    ## MINIMUM_PAYMENTS                 2.895549e+02 3.535365e+02 5.773985e+02
    ## PRC_FULL_PAYMENT                 2.138187e-02 3.166474e-02 3.602395e-03

    write.csv(t(profil_clusters), "../../data/processed/data_pour_Interprétation_des_profils_obtenus.csv", row.names = FALSE)

    write.csv(donnees_finales, "../../data/processed/clustered_data.csv", row.names = FALSE)
    print(donnees_finales)

    ##        BALANCE BALANCE_FREQUENCY PURCHASES ONEOFF_PURCHASES INSTALLMENTS_PURCHASES
    ## 1    40.900749          0.818182     95.40             0.00                  95.40
    ## 2   817.714335          1.000000     16.00            16.00                   0.00
    ## 3  1823.652743          1.000000    436.20             0.00                 436.20
    ## 4  1014.926473          1.000000    861.49           661.49                 200.00
    ## 5  2772.772734          1.000000      0.00             0.00                   0.00
    ## 6   169.781679          1.000000    399.60             0.00                 399.60
    ## 7  1615.967240          1.000000    102.00           102.00                   0.00
    ## 8   125.694817          1.000000    233.28             0.00                 233.28
    ## 9    22.063490          1.000000    100.00             0.00                 100.00
    ## 10 1656.350781          1.000000      0.00             0.00                   0.00
    ## 11 1360.742377          1.000000      0.00             0.00                   0.00
    ## 12  863.809833          1.000000    507.50           507.50                   0.00
    ## 13 1565.681099          1.000000      0.00             0.00                   0.00
    ## 14 1555.793701          1.000000     66.20            66.20                   0.00
    ## 15 1758.059987          1.000000    412.33           325.21                  87.12
    ## 16 1576.305029          1.000000      0.00             0.00                   0.00
    ## 17  578.809679          1.000000    320.00             0.00                 320.00
    ## 18   17.357563          0.909091    244.85            40.21                 204.64
    ## 19 4037.305658          1.000000     45.00            45.00                   0.00
    ## 20 1321.476080          1.000000     45.65            45.65                   0.00
    ## 21 2441.542991          1.000000    808.00           808.00                   0.00
    ## 22  408.656365          1.000000    941.64             0.00                 941.64
    ## 23 1246.624558          1.000000    423.70           177.64                 246.06
    ## 24 2662.629852          1.000000      0.00             0.00                   0.00
    ## 25 4245.855092          1.000000   1957.30          1077.30                 880.00
    ## 26   24.284970          0.636364    250.60             0.00                 250.60
    ## 27  231.108995          1.000000    440.00             0.00                 440.00
    ## 28  706.132889          1.000000    897.86           714.52                 183.34
    ## 29  947.130810          1.000000    197.06           148.66                  48.40
    ## 30  764.042156          0.818182      0.00             0.00                   0.00
    ## 31 3057.400553          1.000000   1025.00          1025.00                   0.00
    ## 32 1046.370410          1.000000    295.00           295.00                   0.00
    ## 33 2737.367678          1.000000      0.00             0.00                   0.00
    ## 34  871.568977          1.000000    648.22           115.00                 533.22
    ## 35 1610.040203          1.000000    557.19           525.64                  31.55
    ## 36 1608.451822          1.000000      0.00             0.00                   0.00
    ## 37 1706.014379          1.000000    147.78             0.00                 147.78
    ## 38  874.583247          1.000000    516.54           159.07                 357.47
    ## 39  966.251742          1.000000    311.45           311.45                   0.00
    ## 40   38.615644          0.727273    280.40           280.40                   0.00
    ## 41  566.546048          0.909091    405.75           313.75                  92.00
    ## 42   75.647479          0.727273    540.00             0.00                 540.00
    ## 43   28.461629          1.000000    100.00           100.00                   0.00
    ## 44 1070.999446          1.000000    990.70           482.00                 508.70
    ## 45 2229.857287          1.000000     45.65            45.65                   0.00
    ## 46 1874.716289          1.000000    301.10            83.00                 218.10
    ## 47    6.390383          1.000000     79.66             0.00                  79.66
    ## 48   19.508047          1.000000    193.14             0.00                 193.14
    ## 49 3905.365959          1.000000    150.80           150.80                   0.00
    ## 50 1873.084577          1.000000    126.57           126.57                   0.00
    ## 51 2420.761135          1.000000      0.00             0.00                   0.00
    ## 52  927.041961          1.000000      0.00             0.00                   0.00
    ## 53   40.089221          1.000000    225.00             0.00                 225.00
    ## 54  850.630114          1.000000      0.05             0.05                   0.00
    ## 55 2669.160638          1.000000      0.00             0.00                   0.00
    ## 56  907.982017          1.000000    216.94           216.94                   0.00
    ## 57 1254.669100          1.000000    361.73           361.73                   0.00
    ## 58 1543.287931          1.000000      0.00             0.00                   0.00
    ##    CASH_ADVANCE PURCHASES_FREQUENCY ONEOFF_PURCHASES_FREQUENCY
    ## 1       0.00000            0.166667                   0.000000
    ## 2       0.00000            0.083333                   0.083333
    ## 3       0.00000            1.000000                   0.000000
    ## 4       0.00000            0.333333                   0.083333
    ## 5     346.81139            0.000000                   0.000000
    ## 6       0.00000            1.000000                   0.000000
    ## 7     244.84049            0.166667                   0.166667
    ## 8       0.00000            1.000000                   0.000000
    ## 9       0.00000            0.416667                   0.000000
    ## 10     99.26437            0.000000                   0.000000
    ## 11   1481.58709            0.000000                   0.000000
    ## 12    695.09716            0.166667                   0.166667
    ## 13    321.35913            0.000000                   0.000000
    ## 14      0.00000            0.083333                   0.083333
    ## 15      0.00000            0.583333                   0.333333
    ## 16    382.90855            0.000000                   0.000000
    ## 17      0.00000            0.750000                   0.000000
    ## 18      0.00000            0.666667                   0.166667
    ## 19    104.23806            0.083333                   0.083333
    ## 20    495.65793            0.083333                   0.083333
    ## 21    959.85726            0.250000                   0.250000
    ## 22      0.00000            1.000000                   0.000000
    ## 23    412.39906            0.666667                   0.166667
    ## 24    509.02380            0.000000                   0.000000
    ## 25      0.00000            0.833333                   0.166667
    ## 26      0.00000            0.583333                   0.000000
    ## 27      0.00000            0.916667                   0.000000
    ## 28    586.26897            0.916667                   0.333333
    ## 29      0.00000            0.333333                   0.250000
    ## 30   1307.10252            0.000000                   0.000000
    ## 31      0.00000            0.083333                   0.083333
    ## 32     93.57981            0.083333                   0.083333
    ## 33    429.69116            0.000000                   0.000000
    ## 34      0.00000            1.000000                   0.083333
    ## 35      0.00000            0.250000                   0.083333
    ## 36    205.73717            0.000000                   0.000000
    ## 37   1657.09028            0.166667                   0.000000
    ## 38      0.00000            1.000000                   0.333333
    ## 39    955.95975            0.333333                   0.333333
    ## 40      0.00000            0.250000                   0.250000
    ## 41   1044.65162            0.500000                   0.166667
    ## 42      0.00000            0.250000                   0.000000
    ## 43      0.00000            0.083333                   0.083333
    ## 44      0.00000            0.750000                   0.250000
    ## 45      0.00000            0.083333                   0.083333
    ## 46      0.00000            0.583333                   0.166667
    ## 47      0.00000            1.000000                   0.000000
    ## 48      0.00000            0.416667                   0.000000
    ## 49   1659.19931            0.166667                   0.166667
    ## 50    181.13938            0.250000                   0.250000
    ## 51    567.23380            0.000000                   0.000000
    ## 52    402.97416            0.000000                   0.000000
    ## 53      0.00000            1.000000                   0.000000
    ## 54   1700.63459            0.083333                   0.083333
    ## 55    142.14132            0.000000                   0.000000
    ## 56   1011.99794            0.166667                   0.166667
    ## 57    198.68674            0.166667                   0.166667
    ## 58     36.48183            0.000000                   0.000000
    ##    PURCHASES_INSTALLMENTS_FREQUENCY CASH_ADVANCE_FREQUENCY CASH_ADVANCE_TRX PURCHASES_TRX
    ## 1                          0.083333               0.000000                0             2
    ## 2                          0.000000               0.000000                0             1
    ## 3                          1.000000               0.000000                0            12
    ## 4                          0.250000               0.000000                0             5
    ## 5                          0.000000               0.083333                1             0
    ## 6                          1.000000               0.000000                0            12
    ## 7                          0.000000               0.250000                5             2
    ## 8                          1.000000               0.000000                0            12
    ## 9                          0.416667               0.000000                0             5
    ## 10                         0.000000               0.083333                1             0
    ## 11                         0.000000               0.083333                1             0
    ## 12                         0.000000               0.083333                2             3
    ## 13                         0.000000               0.250000                3             0
    ## 14                         0.000000               0.000000                0             1
    ## 15                         0.166667               0.000000                0            11
    ## 16                         0.000000               0.416667                6             0
    ## 17                         0.666667               0.000000                0             8
    ## 18                         0.583333               0.000000                0            13
    ## 19                         0.000000               0.083333                1             1
    ## 20                         0.000000               0.083333                1             1
    ## 21                         0.000000               0.333333                6             4
    ## 22                         1.000000               0.000000                0            12
    ## 23                         0.500000               0.083333                2            10
    ## 24                         0.000000               0.333333                4             0
    ## 25                         0.583333               0.000000                0            19
    ## 26                         0.500000               0.000000                0             7
    ## 27                         0.916667               0.000000                0            22
    ## 28                         0.916667               0.250000                3            18
    ## 29                         0.166667               0.000000                0             5
    ## 30                         0.000000               0.166667                3             0
    ## 31                         0.000000               0.000000                0             2
    ## 32                         0.000000               0.083333                1             2
    ## 33                         0.000000               0.416667                5             0
    ## 34                         1.000000               0.000000                0            27
    ## 35                         0.166667               0.000000                0             5
    ## 36                         0.000000               0.166667                2             0
    ## 37                         0.166667               0.250000                4             2
    ## 38                         0.916667               0.000000                0            30
    ## 39                         0.000000               0.083333                1            15
    ## 40                         0.000000               0.000000                0             3
    ## 41                         0.416667               0.333333                6            12
    ## 42                         0.166667               0.000000                0             3
    ## 43                         0.000000               0.000000                0             1
    ## 44                         0.583333               0.000000                0            13
    ## 45                         0.000000               0.000000                0             1
    ## 46                         0.333333               0.000000                0            10
    ## 47                         1.000000               0.000000                0            12
    ## 48                         0.416667               0.000000                0             5
    ## 49                         0.000000               0.416667                5             2
    ## 50                         0.000000               0.083333                1             4
    ## 51                         0.000000               0.083333                2             0
    ## 52                         0.000000               0.333333                5             0
    ## 53                         1.000000               0.000000                0            12
    ## 54                         0.000000               0.333333                7             1
    ## 55                         0.000000               0.166667                2             0
    ## 56                         0.000000               0.166667                5             3
    ## 57                         0.000000               0.083333                1             2
    ## 58                         0.000000               0.083333                1             0
    ##    CREDIT_LIMIT   PAYMENTS MINIMUM_PAYMENTS PRC_FULL_PAYMENT Cluster
    ## 1          1000  201.80208        139.50979         0.000000       1
    ## 2          1200  678.33476        244.79124         0.000000       1
    ## 3          2300  679.06508        532.03399         0.000000       2
    ## 4          7000  688.27857        311.96341         0.000000       2
    ## 5          3000  805.64797        989.96287         0.000000       3
    ## 6          3000  215.30614        163.00554         0.000000       2
    ## 7          1700  890.17885        971.18321         0.000000       3
    ## 8          1000  207.77372        164.74882         0.000000       2
    ## 9          6900  160.76777        159.68444         0.000000       1
    ## 10         1800  351.50020        634.56931         0.000000       1
    ## 11         1500  378.29423        321.35414         0.000000       3
    ## 12         4000  587.86645        286.44872         0.083333       1
    ## 13         3500  691.82528        581.48192         0.000000       3
    ## 14         1600  338.08366        837.21567         0.000000       1
    ## 15         1800  777.45165        897.90544         0.000000       2
    ## 16         2500  540.02223        352.88380         0.000000       3
    ## 17         1500 1438.91057        190.18654         0.000000       2
    ## 18         5000  357.80208        121.52342         0.181818       2
    ## 19         4500 1073.84488        968.94127         0.000000       3
    ## 20         1800  440.84044        312.56064         0.000000       1
    ## 21         4000  532.74170       1026.97600         0.000000       3
    ## 22         2500 1097.78942        176.61060         0.083333       2
    ## 23         2000  577.05037        498.36542         0.000000       2
    ## 24         3000  932.41886        709.20702         0.000000       3
    ## 25         5000 1004.35474       1086.42891         0.000000       2
    ## 26         3000  319.76290        173.63201         0.000000       1
    ## 27         4000  554.11654        185.09104         0.000000       2
    ## 28         1200  972.35805        184.52438         0.000000       2
    ## 29         1000  492.20042        509.38418         0.000000       1
    ## 30         7500 1566.80690        172.95973         0.000000       3
    ## 31         7500  698.85410        819.68267         0.000000       2
    ## 32         1200  439.40708        362.83819         0.000000       1
    ## 33         3000  778.82799        721.79858         0.000000       3
    ## 34         1200 1110.88642        208.29842         0.000000       2
    ## 35         4000  422.71185        616.00584         0.000000       2
    ## 36         1800  470.56598        408.79915         0.000000       3
    ## 37         6000 1186.06276        374.59551         0.000000       3
    ## 38          900  579.74931        693.89472         0.000000       2
    ## 39         1500  277.52244        286.29933         0.000000       1
    ## 40         6150  254.39298         55.79974         0.090909       1
    ## 41         2000 1249.83514        313.05269         0.000000       3
    ## 42         4000  548.96728         48.65993         0.000000       1
    ## 43         4000  125.76917        104.85752         0.000000       1
    ## 44         1400  505.31733        438.32402         0.000000       2
    ## 45         2500  542.74630        628.21103         0.000000       1
    ## 46         1950  586.97405       1089.04027         0.000000       2
    ## 47         1500   75.89629         75.96774         0.000000       2
    ## 48         2000  220.46377         71.96506         0.250000       1
    ## 49         7500  990.52441        989.78329         0.000000       3
    ## 50         2100  483.55746        524.42639         0.000000       3
    ## 51         3000  871.71332        609.20678         0.000000       3
    ## 52         1000  719.97424        339.55309         0.000000       3
    ## 53         1500  325.57850        286.12259         0.166667       2
    ## 54         1000 1084.28113        367.40954         0.000000       3
    ## 55         3000  642.77706       1122.07614         0.000000       3
    ## 56         3200  222.02316        300.21005         0.000000       3
    ## 57         1500  535.60682        432.68808         0.000000       1
    ## 58         1800  548.58939        529.34049         0.000000       1
    ##  [ reached 'max' / getOption("max.print") -- omitted 1977 rows ]
