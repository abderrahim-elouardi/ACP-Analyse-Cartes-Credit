---
title: "Test d'Adéquation de l'ACP"
output: 
  github_document:
    toc: true        # table des matières optionnelle
    fig_width: 6     # largeur des graphiques
    fig_height: 4    # hauteur des graphiques
---

# Test d'Adéquation de l'ACP

## Pourquoi tester l'adéquation?

Avant de faire une ACP, il faut vérifier que:
1. Les variables sont corrélées entre elles
2. L'ACP a du sens pour ces données

---

## 1. Charger les données

```{r, message=FALSE, warning=FALSE}
# Charger les packages
library(here)
library(psych)

# Charger les données
data_standardise <- read.csv(here("data/processed/credit_card_clean_standardised.csv"))

# Voir les dimensions
dim(data_standardise)
head(data_standardise)
```

---

## 2. Test KMO (Kaiser-Meyer-Olkin)

Le test KMO mesure si les données sont bonnes pour une ACP.

```{r}
# Calculer la matrice de corrélation
cor_matrix <- cor(data_standardise)

# Faire le test KMO
kmo_result <- KMO(cor_matrix)

# Voir le résultat
print(kmo_result)
```

### Interprétation du KMO

- **KMO > 0.8**: Très bon ✅
- **KMO 0.6-0.8**: Bon ✅
- **KMO < 0.6**: Mauvais ❌

```{r}
# Extraire la valeur KMO globale
kmo_result <- KMO(cor_matrix)

# Extraire le KMO global (NUMÉRIQUE)
kmo_global <- as.numeric(kmo_result$MSA)

# Interpréter
if (kmo_global > 0.6) {
  print(" Les données sont bonnes pour l'ACP")
} else {
  print(" Les données ne sont pas bonnes pour l'ACP")
}
```

---

## 3. Test de Bartlett

Le test de Bartlett vérifie que les variables sont corrélées.

```{r}
# Calculer le test de Bartlett manuellement
n <- nrow(data_standardise)
det_cor <- det(cor_matrix)

# Statistique du test
bartlett_stat <- -n * log(det_cor)

# P-value
df <- (ncol(data_standardise) * (ncol(data_standardise) - 1)) / 2
p_value <- 1 - pchisq(bartlett_stat, df)

# Afficher les résultats
print(paste("Statistique de Bartlett:", round(bartlett_stat, 3)))
print(paste("P-value:", formatC(p_value, format = "e", digits = 2)))
```

### Interprétation du test de Bartlett

- **P-value < 0.05**: Les variables sont corrélées (bon pour ACP)
- **P-value > 0.05**: Les variables ne sont pas corrélées (mauvais pour ACP)

```{r}
if (p_value < 0.05) {
  print(" Les variables sont corrélées - ACP appropriée")
} else {
  print(" Les variables ne sont pas corrélées - ACP non appropriée")
}
```

---

## 5. Conclusion

```{r}
# Résumé final
cat("KMO global:", round(kmo_global, 3), "\n")
cat("P-value Bartlett:", formatC(p_value, format = "e", digits = 2), "\n\n")

if (kmo_global > 0.6 && p_value < 0.05) {
  cat(" L'ACP EST APPROPRIÉE\n")
  cat("Vous pouvez continuer avec l'ACP!\n")
} else {
  cat(" L'ACP PEUT NE PAS ÊTRE APPROPRIÉE\n")
  cat("Soyez prudent dans l'interprétation.\n")
}
```
