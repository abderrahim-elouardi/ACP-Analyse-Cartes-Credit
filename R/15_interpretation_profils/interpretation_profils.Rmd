---
title: "15_interpretation_profils"
output: 
  github_document:
    toc: true
    fig_width: 10
    fig_height: 7
---

## 15. Interprétation des profils obtenus

Ce document propose une lecture simple (niveau étudiant) des profils issus du clustering, à partir des variables disponibles.

### 15.1 Description des profils comportementaux

```{r}
# Chargement des librairies utiles
suppressMessages({
  library(dplyr)
  library(tidyr)
  library(ggplot2)
})

# Données préparées lors de l'étape de clustering
# (variables originales + colonne Cluster)
donnees <- read.csv("../../data/processed/clustered_data.csv")
donnees$Cluster <- as.factor(donnees$Cluster)

# Aperçu rapide
head(donnees)

# Résumé simple par groupe : moyenne des variables numériques par cluster
resume <- donnees %>%
  group_by(Cluster) %>%
  summarise(across(where(is.numeric), ~ mean(.x, na.rm = TRUE)), .groups = "drop")
resume

# Graphique 1 : Taille des groupes (barres)
ggplot(donnees, aes(x = as.factor(Cluster))) +
  geom_bar(fill = "#2C7FB8") +
  labs(title = "Nombre d'observations par Cluster", x = "Cluster", y = "Compte") +
  theme_minimal()
```

Lecture du graphique:
- Chaque barre montre combien d'observations appartiennent à un `Cluster`.
- Des groupes trop petits peuvent être moins stables; des groupes très grands peuvent être trop hétérogènes.

- Interprétez chaque `Cluster` en repérant les valeurs moyennes les plus élevées/faibles sur les variables clés (exemples: limite de crédit, solde moyen, fréquence de paiement, etc.).
- Donnez un nom simple à chaque profil (ex.: "Clients prudents", "Gros utilisateurs", "Équilibrés").

### 15.2 Analyse comparative des groupes

```{r}
# Taille de chaque groupe
compte <- donnees %>% count(Cluster)
compte

# Variables qui différencient le plus les groupes (écart max des moyennes)
variances <- donnees %>%
  group_by(Cluster) %>%
  summarise(across(where(is.numeric), ~ mean(.x, na.rm = TRUE))) %>%
  pivot_longer(-Cluster, names_to = "variable", values_to = "moyenne") %>%
  group_by(variable) %>%
  summarise(ecart_max = max(moyenne) - min(moyenne)) %>%
  arrange(desc(ecart_max))
head(variances, 5)

# On prend les 5 variables les plus différenciantes
top_vars <- variances$variable[1:min(5, nrow(variances))]

# Préparation des moyennes par cluster pour ces variables
resume_long <- resume %>%
  pivot_longer(cols = -Cluster, names_to = "variable", values_to = "moyenne") %>%
  filter(variable %in% top_vars)

# Graphique 2 : Comparaison des moyennes par variable et par cluster (facettes)
ggplot(resume_long, aes(x = as.factor(Cluster), y = moyenne, fill = as.factor(Cluster))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ variable, scales = "free_y") +
  labs(title = "Variables les plus différenciantes par Cluster",
       x = "Cluster", y = "Moyenne") +
  theme_minimal()
```

Lecture du graphique:
- Pour chaque variable (une facette), comparez la hauteur des barres.
- Les barres plus hautes indiquent des valeurs moyennes plus élevées dans ce `Cluster`.
- Repérez les variables où l'écart entre groupes est le plus marqué pour décrire les profils.

- Comparez les groupes sur les 3 à 5 variables les plus différenciantes.
- Expliquez en une phrase la spécificité de chaque groupe par rapport aux autres.

### 15.3 Implications pratiques

- Proposez une action par profil (ex.: offre de fidélité pour les gros utilisateurs, accompagnement budgétaire pour les clients à solde élevé).
- Suggérez comment ces profils peuvent aider à mieux cibler la communication ou les produits.
- Mentionnez une limite: les profils évoluent, il faut les réévaluer régulièrement.

### Annexe : Vue d'ensemble (Heatmap des moyennes standardisées)

```{r}
# Standardisation des moyennes pour visualiser toutes les variables sur une échelle comparable
resume_scaled <- resume
num_cols <- sapply(resume_scaled, is.numeric)
resume_scaled[num_cols] <- scale(resume_scaled[num_cols])

heatmap_long <- resume_scaled %>%
  pivot_longer(cols = where(is.numeric), names_to = "variable", values_to = "zscore")

ggplot(heatmap_long, aes(x = variable, y = as.factor(Cluster), fill = zscore)) +
  geom_tile() +
  scale_fill_gradient2(low = "#2166AC", mid = "#FFFFFF", high = "#B2182B") +
  labs(title = "Heatmap des moyennes standardisées par Cluster",
       x = "Variable", y = "Cluster", fill = "z-score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Lecture du graphique:
- Couleurs rouges: au-dessus de la moyenne (z-score positif); bleues: en dessous.
- Lignes (clusters) avec plusieurs cases rouges indiquent des profils "forts" sur ces variables.
- Utilisez cette vue pour nommer simplement les profils (ex.: "Gros utilisateurs" si beaucoup de variables d'usage sont en rouge).
